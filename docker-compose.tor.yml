version: '3.7'

services:
  core_tor:
    image: ${CORE_TOR_DOCKER_IMAGE:?err}
    restart: unless-stopped
    ports:
      - ${CORE_TOR_PROXY_PORT:?err}:${CORE_TOR_PROXY_PORT:?err}
    volumes:
      - ${DASHMATE_HOME_DIR:?err}/${CONFIG_NAME:?err}/core/tor/torrc:/etc/tor/torrc
    environment:
      - PASSWORD=${CORE_TOR_CONTROL_PASSWORD}

  core:
    depends_on:
      - core_tor
    environment:
      - TOR_CONTROL_HOST=core_tor
      - TOR_CONTROL_PORT=${CORE_TOR_CONTROL_PORT}
      - TOR_CONTROL_PASSWORD=${CORE_TOR_CONTROL_PASSWORD}
      - TOR_PROXY_PORT=${CORE_TOR_PROXY_PORT}
